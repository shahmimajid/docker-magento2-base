box: php:7.1.20-fpm-jessie
## Build Definition
build:
  # Step that will be executed on build
  steps:
    # Install packages required
    - install-packages:
        packages: git zip unzip libfreetype6-dev cron libjpeg62-turbo-dev libmcrypt-dev libpng12-dev libxml2-dev libxslt1-dev libicu-dev mysql-client xmlstarlet
    # Test the project
    - script:
        name: Prepare AuthKey for Magento Download via composer
        code: |
           mkdir -p $HOME/.composer
           cp $WERCKER_SOURCE_DIR/auth.json $HOME/.composer
           sed -i "s/PUBKEY/$MAGENTOPUBKEY/g" $HOME/.composer/auth.json
           sed -i "s/PRIVKEY/$MAGENTOPRIVKEY/g" $HOME/.composer/auth.json
           cat $HOME/.composer/auth.json
    - script:
        name: Install composer
        code: |
           curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer  
    - script:
        name: Download Magento via composer
        code: |
           cd $WERCKER_SOURCE_DIR/src
           rm -rf .gitkeep
           composer create-project --repository=https://repo.magento.com/ magento/project-community-edition .